/**
 * @module beautify-form
 * @author nuintun
 * @license MIT
 * @version 2017/08/29
 * @description Beautify the web forms.
 * @see https://github.com/nuintun/beautify-form
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define("beautify-form",["jquery"],t):e.BeautifyForm=t(e.jQuery)}(this,function(e){"use strict";var t=Object.defineProperty,i=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,n=Object.getOwnPropertyDescriptor,s=i?function(e,t){return n(i(e),t)||n(HTMLElement.prototype,t)||n(Element.prototype,t)||n(Node.prototype,t)}:function(e,t){var i=Element.prototype,s=o.call(i,t);if(s||(i=e.constructor.prototype,s=o.call(i,t)),s)return n(i,t)};function r(e){this.node=e}r.prototype={watch:function(e,i){var o=this.node,n=s(o,e);if(n&&(n.set||n.get)){var r={configurable:!0,enumerable:n.enumerable};n.set&&(r.set=function(t){var o=this[e];return o!==t&&(n.set.call(this,t),i.call(this,o,t)),t}),n.get&&(r.get=function(){return n.get.call(this)}),t(o,e,r)}return this},unwatch:function(e){return delete this.node[e],this}};var c=e(window),h=e(document);function l(){try{var e=document.activeElement,t=e.contentDocument;return t&&t.activeElement||e}catch(i){}}var a={};function d(t){this.destroyed=!1,this.element=e(t),this.type=t.type,this.observer=new r(t),this.type=this.type?this.type.toLowerCase():undefined;var i=d.get(t);if(i)return i;if("checkbox"!==this.type&&"radio"!==this.type)throw new TypeError("The element must be a checkbox or radio.");this.__init()}d.get=function(t){return(t=e(t)).data("beautify-choice")},d.prototype={__init:function(){var e=this.type;function t(){var t,i=d.get(this);i&&("radio"===e&&(t=this,h.find("input[type=radio][name="+t.name+"]").each(function(e,i){var o=d.get(i);o&&t!==i&&o.refresh()})),i.refresh())}if(this.observer.watch("checked",t).watch("disabled",t),"checkbox"===e&&this.observer.watch("indeterminate",t),a[e]=a[e]||0,!a[e]){var i=".beautify-"+e,o="input[type="+e+"]";h.on("focusin"+i,o,t).on("change"+i,o,t).on("focusout"+i,o,t),"checkbox"===e&&h.on("click"+i,o,t)}return this.__beautify()},__beautify:function(){var e=this.type,t=this.element;return t.wrap('<i tabindex="-1" class="ui-beautify-choice ui-beautify-'+e+'"/>'),this.choice=t.parent(),this.choice.attr("role",e),t.data("beautify-choice",this),a[e]++,this.refresh()},refresh:function(){var e=this.type,t=this.choice,i=this.element[0],o=i.indeterminate;return t.toggleClass("ui-beautify-choice-disabled",i.disabled).toggleClass("ui-beautify-choice-focus",l()===i),"checkbox"===e?t.toggleClass("ui-beautify-choice-checked",!o&&i.checked).toggleClass("ui-beautify-choice-indeterminate",o):t.toggleClass("ui-beautify-choice-checked",i.checked),this},destroy:function(){if(!this.destroyed){var e=this.type,t=this.element;if(t.unwrap().removeData("beautify-choice"),this.observer.unwatch("checked").unwatch("disabled"),"checkbox"===e&&(this.observer.unwatch("indeterminate"),t.off("click"+i)),!--a[e]){var i=".beautify-"+e;h.off("focusin"+i).off("change"+i).off("focusout"+i),"checkbox"===e&&h.off("click"+i),delete a[e]}this.destroyed=!0}}};var u,f=document.documentElement.scrollIntoViewIfNeeded;var p=0,b=null,y={width:c.width(),height:c.height()};function m(t,i){var o=[].slice.call(arguments,2),n=i.apply(t,o);if("string"===e.type(n))return n;throw new TypeError("Render function must return a string.")}function w(t,i){if(this.type="select",this.opened=!1,this.destroyed=!1,this.element=e(t),this.observer=new r(t),t.multiple||t.size>1)return this;i=e.extend({title:function(e,t){return'<i class="ui-beautify-select-align-middle"></i><span class="ui-beautify-select-title" title="'+t+'">'+t+'</span><i class="ui-beautify-select-icon"></i>'},dropdown:function(e,t){return'<dl class="ui-beautify-select-dropdown-items">'+t+"</dl>"},optgroup:function(e,t){return'<dt class="ui-beautify-select-optgroup" title="'+t+'">'+t+"</dt>"},option:function(e,t){return'<dd role="option" class="ui-beautify-select-option'+(t.group?" ui-beautify-select-optgroup-option":"")+(t.className?" "+t.className:"")+'" '+t.indexAttr+'="'+t.index+'" title="'+t.text+'">'+t.text+"</dd>"},dropdownWidth:null,optionIndexAttr:"data-option",optionSelectedClass:"ui-beautify-select-option-selected",optionDisabledClass:"ui-beautify-select-option-disabled"},i),e.each(["title","dropdown","optgroup","option"],function(t,o){if("function"!==e.type(i[o]))throw new TypeError("Options."+o+" must be a function.")}),this.options=i,this.__init()}function v(e){return function(t,i){if("api"===t)return e.get(this[0]);var o=arguments;return o.length>1&&(i=[].slice.call(o,1)),i=i||[],this.each(function(o,n){var s=e.get(n);s||(s=new e(n,t)),s[t]&&s[t].apply(s,i)})}}return w.get=function(t){return(t=e(t)).data("beautify-select")},w.prototype={__init:function(){var t=this,i=t.type,o=t.options,n=".beautify-"+i;function s(){var e=w.get(this);e&&(e.__renderTitlebox(),e.opened&&e.__refreshSelected())}function r(){var e=w.get(this);e&&e.__refreshSelectbox()}if(b=t,t.observer.watch("disabled",r).watch("selectedIndex",s),!p){h.on("focusin"+n,"select",r).on("change"+n,"select",s).on("focusout"+n,"select",r).on("mousedown"+n,function(t){var i=t.target,o=b.selectbox[0];i!==o&&!e.contains(o,i)&&b.opened&&(b.close(),b.__refreshSelectbox())}).on("keydown"+n,function(e){9!==e.which&&27!==e.which||(b.opened&&b.close(),b.__refreshSelectbox())}),c.on("resize"+n,function(){clearTimeout(u),y.width=c.width(),y.height=c.height(),u=setTimeout(function(){b.opened&&b.__position()},0)})}return t.__beautify(),t.element.on("keypress"+n,function(e){13===e.which&&(e.preventDefault(),t.opened?t.close():t.open())}),t.selectbox.on("mousedown"+n,function(i){i.preventDefault();var o=t.element;if(!o[0].disabled){if(t.opened){var n=i.target,s=t.dropdown[0];s===n||e.contains(s,n)||t.close()}else t.open();setTimeout(function(){o.focus()},0)}}).on("click"+n,"["+o.optionIndexAttr+"]",function(i){i.preventDefault();var n=e(this);n.hasClass(o.optionDisabledClass)||(t.element[0].selectedIndex=n.attr(o.optionIndexAttr),t.close())}),t},__sizeSelectbox:function(){var e=this.element,t=this.selectbox,i=e.outerWidth()-t.outerWidth()+t.width(),o=e.outerHeight()-t.outerHeight()+t.height();return t.width(i),t.height(o),this},__sizeDropdown:function(){this.opened||(this.dropdown.css("visibility","hidden"),this.dropdown.appendTo(this.selectbox));var e=this.dropdown,t=this.element.clone(),i={width:e.width(),outerWidth:e.outerWidth()};t.css({position:"absolute",visibility:"hidden",width:"auto",top:"-100%",left:"-100%"}),t.insertBefore(this.element);var o=t.outerWidth();return t.remove(),o=Math.max(o,this.element.outerWidth())-i.outerWidth+i.width,o=Math.max(o,this.options.dropdownWidth||0),e.width(o),this.opened||(this.dropdown.detach(),this.dropdown.css("visibility","visible")),this},__position:function(){if(this.opened){var e=this.selectbox,t=this.dropdown,i=e[0].getBoundingClientRect(),o={window:{height:c.height()},selectbox:{outerHeight:e.outerHeight()},dropdown:{outerHeight:t.outerHeight()}},n=i.top>c.height()-i.bottom?"top":"bottom";t.removeClass("ui-beautify-select-dropdown-"+("top"===n?"bottom":"top")).addClass("ui-beautify-select-dropdown-"+n),t.css({top:"bottom"===n?o.selectbox.outerHeight:-o.dropdown.outerHeight})}return this},__renderTitlebox:function(){var e="",t=null,i=this.element[0],o=this.options.title,n=i.selectedIndex;return n>=0&&(e=(t=i.options[n]).innerHTML),this.titlebox.html(m(this,o,t,e)),this},__renderDropdown:function(){var t=0,i="",o=this,n=o.options,s=o.element[0].selectedIndex;function r(e,r){var c=t===s,h={group:r,index:t++,text:e.html(),indexAttr:n.optionIndexAttr,className:e[0].disabled?n.optionDisabledClass:c?n.optionSelectedClass:""};i+=m(o,n.option,e,h)}var c=o.element.children();return c.each(function(){var t=e(this);switch(this.nodeName.toLowerCase()){case"option":r(t);break;case"optgroup":!function(e){i+=m(o,n.optgroup,e,e.attr("label"))}(t),t.children().each(function(){r(e(this),t)})}}),o.dropdown.html(m(o,n.dropdown,c,i)),o},__refreshSelectbox:function(){var t=this.element[0],i=this.selectbox,o=l();return o=this.opened||o===t||o===i[0]||e.contains(i[0],o),i.toggleClass("ui-beautify-select-disabled",t.disabled).toggleClass("ui-beautify-select-focus",o),this},__refreshSelected:function(){var e=this.options,t=this.dropdown,i=e.optionSelectedClass,o=this.element[0].selectedIndex;t.find("."+i).removeClass(i);var n=t.find("["+e.optionIndexAttr+"="+o+"]");return n.addClass(i),(n=n[0])&&function(e,t){if(!e)throw new Error("Element is required in scrollIntoViewIfNeeded");if(f)return e.scrollIntoViewIfNeeded(t);function i(e,i,o,n){return!1===t||o<=e+n&&e<=i+n?Math.min(o,Math.max(i,e)):(i+o)/2}for(var o,n=function t(e,i,o,s){return{left:e,top:i,width:o,height:s,right:e+o,bottom:i+s,translate:function(n,r){return t(n+e,r+i,o,s)},relativeFromTo:function(r,c){var h=e,l=i;if((r=r.offsetParent)===(c=c.offsetParent))return n;for(;r;r=r.offsetParent)h+=r.offsetLeft+r.clientLeft,l+=r.offsetTop+r.clientTop;for(;c;c=c.offsetParent)h-=c.offsetLeft+c.clientLeft,l-=c.offsetTop+c.clientTop;return t(h,l,o,s)}}}(e.offsetLeft,e.offsetTop,e.offsetWidth,e.offsetHeight);(o=e.parentNode)!==document;){var s=o.offsetLeft+o.clientLeft,r=o.offsetTop+o.clientTop;n=n.relativeFromTo(e,o).translate(-s,-r);var c=i(o.scrollLeft,n.right-o.clientWidth,n.left,o.clientWidth),h=i(o.scrollTop,n.bottom-o.clientHeight,n.top,o.clientHeight);o.scrollLeft=c,o.scrollTop=h,n=n.translate(s-o.scrollLeft,r-o.scrollTop),e=o}}(n),this},__beautify:function(){var t=this.element;t.addClass("ui-beautify-select-hidden");var i=e('<div role="combobox" tabindex="-1" class="ui-beautify-select"/>');return this.titlebox=e('<div class="ui-beautify-select-titlebox"/>'),this.dropdown=e('<div role="listbox" class="ui-beautify-select-dropdown"/>'),i.append(this.titlebox).insertAfter(this.element),this.selectbox=i,t.data("beautify-select",this),p++,this.refresh()},refresh:function(){return this.__sizeSelectbox(),this.__renderTitlebox(),this.__renderDropdown(),this.__sizeDropdown(),this.__refreshSelectbox()},open:function(){return this.opened?this:(this.opened=!0,b!==this&&(b.opened&&b.close(),b.__refreshSelectbox()),b=this,this.selectbox.addClass("ui-beautify-select-opened"),this.dropdown.appendTo(this.selectbox),this.__position(),this.__refreshSelected(),this)},close:function(){return this.opened&&(this.opened=!1,this.dropdown.detach(),this.selectbox.removeClass("ui-beautify-select-opened")),this},destroy:function(){if(!this.destroyed){var e=this.type,t=this.element,i=".beautify-"+e;this.element.off("keypress"+i),this.selectbox.off().remove(),this.dropdown.remove(),t.removeData("beautify-select").removeClass("ui-beautify-select-hidden"),this.observer.unwatch("disabled").unwatch("selectedIndex"),--p||(h.off("focusin"+i).off("change"+i).off("focusout"+i).off("mousedown"+i).off("keydown"+i),c.off("resize"+i)),this.destroyed=!0}}},e.fn.checkbox=v(d),e.fn.radiobox=v(d),e.fn.selectbox=v(w),{CheckBox:d,RadioBox:d,SelectBox:w}});
//# sourceMappingURL=beautify-form.js.map